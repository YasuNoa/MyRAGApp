{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///app/auth.config.ts"],"sourcesContent":["import type { NextAuthConfig } from \"next-auth\";\n\nexport const authConfig = {\n    pages: {\n        signIn: \"/login\",\n    },\n    callbacks: {\n        async signIn({ account, profile }) {\n            if (account?.provider === \"line\") {\n                if (!profile?.email) {\n                    return \"/login?error=EmailRequired\";\n                }\n            }\n            return true;\n        },\n        authorized({ auth, request: { nextUrl } }) {\n            const isLoggedIn = !!auth?.user;\n            const isOnDashboard = nextUrl.pathname.startsWith(\"/\");\n            const isOnLogin = nextUrl.pathname.startsWith(\"/login\");\n            const isOnRegister = nextUrl.pathname.startsWith(\"/register\");\n\n            if (isOnDashboard) {\n                // ログイン画面と登録画面は誰でもアクセスOK\n                if (isOnLogin || isOnRegister) return true;\n                // その他のページはログイン必須\n                // if (isLoggedIn) return true;\n                // return false; // Redirect unauthenticated users to login page\n            }\n            return true;\n        },\n    },\n    providers: [], // Providers are configured in auth.ts\n} satisfies NextAuthConfig;\n"],"names":[],"mappings":";;;;AAEO,MAAM,aAAa;IACtB,OAAO;QACH,QAAQ;IACZ;IACA,WAAW;QACP,MAAM,QAAO,EAAE,OAAO,EAAE,OAAO,EAAE;YAC7B,IAAI,SAAS,aAAa,QAAQ;gBAC9B,IAAI,CAAC,SAAS,OAAO;oBACjB,OAAO;gBACX;YACJ;YACA,OAAO;QACX;QACA,YAAW,EAAE,IAAI,EAAE,SAAS,EAAE,OAAO,EAAE,EAAE;YACrC,MAAM,aAAa,CAAC,CAAC,MAAM;YAC3B,MAAM,gBAAgB,QAAQ,QAAQ,CAAC,UAAU,CAAC;YAClD,MAAM,YAAY,QAAQ,QAAQ,CAAC,UAAU,CAAC;YAC9C,MAAM,eAAe,QAAQ,QAAQ,CAAC,UAAU,CAAC;YAEjD,IAAI,eAAe;gBACf,wBAAwB;gBACxB,IAAI,aAAa,cAAc,OAAO;YACtC,iBAAiB;YACjB,+BAA+B;YAC/B,gEAAgE;YACpE;YACA,OAAO;QACX;IACJ;IACA,WAAW,EAAE;AACjB"}},
    {"offset": {"line": 54, "column": 0}, "map": {"version":3,"sources":["file:///app/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\n\nconst globalForPrisma = globalThis as unknown as { prisma: PrismaClient };\n\nexport const prisma = globalForPrisma.prisma || new PrismaClient();\n\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = prisma;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAEjB,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,6IAAY;AAEhE,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 67, "column": 0}, "map": {"version":3,"sources":["file:///app/auth.ts"],"sourcesContent":["import NextAuth from \"next-auth\";\nimport Credentials from \"next-auth/providers/credentials\";\nimport { authConfig } from \"./auth.config\";\nimport { PrismaClient } from \"@prisma/client\";\nimport bcrypt from \"bcryptjs\";\n\nimport Line from \"next-auth/providers/line\";\n\nimport { PrismaAdapter } from \"@auth/prisma-adapter\";\nimport { prisma } from \"./src/lib/prisma\";\n\nexport const { handlers, signIn, signOut, auth } = NextAuth({\n    ...authConfig,\n    adapter: PrismaAdapter(prisma),\n    session: { strategy: \"jwt\" },\n    callbacks: {\n        ...authConfig.callbacks,\n        async jwt({ token, user }) {\n            if (user) {\n                token.id = user.id;\n            }\n            return token;\n        },\n        async session({ session, token }) {\n            if (token.id && session.user) {\n                session.user.id = token.id as string;\n            }\n            return session;\n        },\n    },\n    providers: [\n        Line({\n            clientId: process.env.AUTH_LINE_ID,\n            clientSecret: process.env.AUTH_LINE_SECRET,\n            authorization: { params: { scope: \"openid profile email\" } },\n            allowDangerousEmailAccountLinking: true,\n        }),\n        Credentials({\n            credentials: {\n                email: { label: \"Email\", type: \"email\" },\n                password: { label: \"Password\", type: \"password\" },\n            },\n            authorize: async (credentials) => {\n                if (!credentials?.email || !credentials?.password) return null;\n\n                const user = await prisma.user.findUnique({\n                    where: { email: credentials.email as string },\n                });\n\n                if (!user || !user.password) {\n                    return null;\n                }\n\n                const isValid = await bcrypt.compare(\n                    credentials.password as string,\n                    user.password\n                );\n\n                if (isValid) {\n                    return {\n                        id: user.id,\n                        name: user.name,\n                        email: user.email,\n                    };\n                }\n\n                return null;\n            },\n        }),\n    ],\n});\n\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;AAAA;AACA;AAEA;AAEA;AAAA;AAEA;AACA;;;;;;;;AAEO,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,IAAA,gKAAQ,EAAC;IACxD,GAAG,4HAAU;IACb,SAAS,IAAA,qKAAa,EAAC,8HAAM;IAC7B,SAAS;QAAE,UAAU;IAAM;IAC3B,WAAW;QACP,GAAG,4HAAU,CAAC,SAAS;QACvB,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE;YACrB,IAAI,MAAM;gBACN,MAAM,EAAE,GAAG,KAAK,EAAE;YACtB;YACA,OAAO;QACX;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC5B,IAAI,MAAM,EAAE,IAAI,QAAQ,IAAI,EAAE;gBAC1B,QAAQ,IAAI,CAAC,EAAE,GAAG,MAAM,EAAE;YAC9B;YACA,OAAO;QACX;IACJ;IACA,WAAW;QACP,IAAA,8LAAI,EAAC;YACD,UAAU,QAAQ,GAAG,CAAC,YAAY;YAClC,cAAc,QAAQ,GAAG,CAAC,gBAAgB;YAC1C,eAAe;gBAAE,QAAQ;oBAAE,OAAO;gBAAuB;YAAE;YAC3D,mCAAmC;QACvC;QACA,IAAA,qMAAW,EAAC;YACR,aAAa;gBACT,OAAO;oBAAE,OAAO;oBAAS,MAAM;gBAAQ;gBACvC,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YACpD;YACA,WAAW,OAAO;gBACd,IAAI,CAAC,aAAa,SAAS,CAAC,aAAa,UAAU,OAAO;gBAE1D,MAAM,OAAO,MAAM,8HAAM,CAAC,IAAI,CAAC,UAAU,CAAC;oBACtC,OAAO;wBAAE,OAAO,YAAY,KAAK;oBAAW;gBAChD;gBAEA,IAAI,CAAC,QAAQ,CAAC,KAAK,QAAQ,EAAE;oBACzB,OAAO;gBACX;gBAEA,MAAM,UAAU,MAAM,4IAAM,CAAC,OAAO,CAChC,YAAY,QAAQ,EACpB,KAAK,QAAQ;gBAGjB,IAAI,SAAS;oBACT,OAAO;wBACH,IAAI,KAAK,EAAE;wBACX,MAAM,KAAK,IAAI;wBACf,OAAO,KAAK,KAAK;oBACrB;gBACJ;gBAEA,OAAO;YACX;QACJ;KACH;AACL"}},
    {"offset": {"line": 163, "column": 0}, "map": {"version":3,"sources":["file:///app/app/actions/auth.ts"],"sourcesContent":["\"use server\";\n\nimport { signOut } from \"@/auth\";\n\nexport async function logout() {\n    await signOut({ redirectTo: \"/\" });\n}\n"],"names":[],"mappings":";;;;;AAEA;;;;AAEO,eAAe;IAClB,MAAM,IAAA,+GAAO,EAAC;QAAE,YAAY;IAAI;AACpC;;;IAFsB;;AAAA,+OAAA"}},
    {"offset": {"line": 186, "column": 0}, "map": {"version":3,"sources":["file:///app/app/actions/profile.ts"],"sourcesContent":["\"use server\";\n\nimport { auth } from \"@/auth\";\nimport { prisma } from \"@/src/lib/prisma\";\nimport bcrypt from \"bcryptjs\";\nimport { revalidatePath } from \"next/cache\";\n\nexport async function updateProfile(formData: FormData) {\n    const session = await auth();\n    if (!session?.user?.id) {\n        return { error: \"ログインしてください\" };\n    }\n\n    const email = formData.get(\"email\") as string;\n    const password = formData.get(\"password\") as string;\n\n    if (!email && !password) {\n        return { error: \"変更内容を入力してください\" };\n    }\n\n    const updateData: any = {};\n\n    if (email) {\n        // Check if user already has an email\n        const currentUser = await prisma.user.findUnique({\n            where: { id: session.user.id },\n        });\n\n        if (currentUser?.email) {\n            // If email is already set, do not allow update\n            // (Unless we implement a specific email change flow later)\n        } else {\n            // Check if email is already taken by another user\n            const existingUser = await prisma.user.findUnique({\n                where: { email },\n            });\n            if (existingUser && existingUser.id !== session.user.id) {\n                return { error: \"このメールアドレスは既に使用されています\" };\n            }\n            updateData.email = email;\n        }\n    }\n\n    if (password) {\n        if (password.length < 6) {\n            return { error: \"パスワードは6文字以上で入力してください\" };\n        }\n        const hashedPassword = await bcrypt.hash(password, 10);\n        updateData.password = hashedPassword;\n    }\n\n    try {\n        await prisma.user.update({\n            where: { id: session.user.id },\n            data: updateData,\n        });\n        revalidatePath(\"/profile\");\n        let successMessage = \"プロフィールを更新しました\";\n        if (updateData.password && !updateData.email) {\n            successMessage = \"パスワードを更新しました\";\n        } else if (updateData.email && !updateData.password) {\n            successMessage = \"メールアドレスを更新しました\";\n        }\n\n        return { success: successMessage };\n    } catch (error) {\n        console.error(\"Profile update error:\", error);\n        return { error: \"エラーが発生しました\" };\n    }\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;;;;;;;AAEO,eAAe,cAAc,QAAkB;IAClD,MAAM,UAAU,MAAM,IAAA,4GAAI;IAC1B,IAAI,CAAC,SAAS,MAAM,IAAI;QACpB,OAAO;YAAE,OAAO;QAAa;IACjC;IAEA,MAAM,QAAQ,SAAS,GAAG,CAAC;IAC3B,MAAM,WAAW,SAAS,GAAG,CAAC;IAE9B,IAAI,CAAC,SAAS,CAAC,UAAU;QACrB,OAAO;YAAE,OAAO;QAAgB;IACpC;IAEA,MAAM,aAAkB,CAAC;IAEzB,IAAI,OAAO;QACP,qCAAqC;QACrC,MAAM,cAAc,MAAM,8HAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YAC7C,OAAO;gBAAE,IAAI,QAAQ,IAAI,CAAC,EAAE;YAAC;QACjC;QAEA,IAAI,aAAa,OAAO;QACpB,+CAA+C;QAC/C,2DAA2D;QAC/D,OAAO;YACH,kDAAkD;YAClD,MAAM,eAAe,MAAM,8HAAM,CAAC,IAAI,CAAC,UAAU,CAAC;gBAC9C,OAAO;oBAAE;gBAAM;YACnB;YACA,IAAI,gBAAgB,aAAa,EAAE,KAAK,QAAQ,IAAI,CAAC,EAAE,EAAE;gBACrD,OAAO;oBAAE,OAAO;gBAAuB;YAC3C;YACA,WAAW,KAAK,GAAG;QACvB;IACJ;IAEA,IAAI,UAAU;QACV,IAAI,SAAS,MAAM,GAAG,GAAG;YACrB,OAAO;gBAAE,OAAO;YAAuB;QAC3C;QACA,MAAM,iBAAiB,MAAM,4IAAM,CAAC,IAAI,CAAC,UAAU;QACnD,WAAW,QAAQ,GAAG;IAC1B;IAEA,IAAI;QACA,MAAM,8HAAM,CAAC,IAAI,CAAC,MAAM,CAAC;YACrB,OAAO;gBAAE,IAAI,QAAQ,IAAI,CAAC,EAAE;YAAC;YAC7B,MAAM;QACV;QACA,IAAA,+IAAc,EAAC;QACf,IAAI,iBAAiB;QACrB,IAAI,WAAW,QAAQ,IAAI,CAAC,WAAW,KAAK,EAAE;YAC1C,iBAAiB;QACrB,OAAO,IAAI,WAAW,KAAK,IAAI,CAAC,WAAW,QAAQ,EAAE;YACjD,iBAAiB;QACrB;QAEA,OAAO;YAAE,SAAS;QAAe;IACrC,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO;YAAE,OAAO;QAAa;IACjC;AACJ;;;IA9DsB;;AAAA,+OAAA"}},
    {"offset": {"line": 283, "column": 0}, "map": {"version":3,"sources":["file:///app/.next-internal/server/app/profile/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {logout as '001e3cc76ef726934145ae979abf15ac3cb47ec90f'} from 'ACTIONS_MODULE0'\nexport {updateProfile as '408cb6f0d7d334db3a4c2c968bf6303dd11de81f3e'} from 'ACTIONS_MODULE1'\n"],"names":[],"mappings":";AAAA;AACA"}}]
}