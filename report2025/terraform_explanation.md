# Terraform 完全解説：インフラをコードで操る魔法

## 1. Terraformとは？ (IaC: Infrastructure as Code)

Terraformは、**「インフラ（サーバーやDBなど）を、画面ポチポチではなく、コードで定義して作るツール」**です。

*   **昔**: Google Cloudの画面を開いて、ボタンを押して、設定を入力して…（手作業）
*   **Terraform**: 「サーバーを1台ください」というコードを書いて実行するだけ。

**メリット**:
1.  **再現性**: 誰がやっても全く同じ環境が作れる。
2.  **履歴管理**: Gitで管理できるので、「いつ誰が設定を変えたか」がわかる。
3.  **コピペOK**: 似たような環境を作るのが一瞬で終わる。

---

## 2. ファイルの役割分担（RPGに例えて解説）

Terraformにはいくつか決まったファイルがあります。これらはRPG（ロールプレイングゲーム）に例えると分かりやすいです。

### 📜 `main.tf`：冒険の書（シナリオ）
**「何を作るか」**を書くメインのファイルです。
*   「勇者（サーバー）を召喚する」
*   「宝箱（データベース）を設置する」
*   「村（ネットワーク）を作る」
といった**世界の定義**がここに書かれています。

### 🎛️ `variables.tf`：入力フォーム（キャラメイク画面）
**「変更可能な値」**を定義するファイルです。
*   「勇者の名前は変えられるようにしよう」
*   「宝箱の中身は外から決められるようにしよう」
といった**設定項目の定義**です。ここでは「値そのもの」は入れず、「こういう設定項目があるよ」という枠だけ作ります。

### 🔑 `terraform.tfvars`：秘密のメモ（パスワード帳）
**「実際の値」**を入れるファイルです。
*   「勇者の名前は『アーサー』にする」
*   「APIキーは『secret_123』にする」
といった**具体的な設定値**を書きます。
**重要**: パスワードなどが含まれるので、このファイルは**絶対にGitに上げてはいけません**（`.gitignore` に入れる）。

### 📤 `outputs.tf`：クリア画面（リザルト）
**「作成後に表示したい情報」**を書くファイルです。
*   「召喚された勇者のHPを表示する」
*   「作られたサーバーのURLを表示する」
`terraform apply` が終わった後に、ターミナルにポンと表示してくれます。

---

## 3. 最重要：`.tfstate` とは？（セーブデータ）

`terraform.tfstate` というファイルが勝手に作られますが、これが一番大事です。

### 正体は「Terraformの記憶（セーブデータ）」
Terraformは、**「自分が前回どこまで作ったか」**をこのファイルに記録しています。

*   **現実**: Google Cloud上にサーバーAがある。
*   **コード (`main.tf`)**: サーバーAを作れと書いてある。
*   **記憶 (`.tfstate`)**: 「前回、ID:123のサーバーAを作ったよ」と書いてある。

### なぜ必要なの？
あなたがもう一度 `terraform apply` をした時、Terraformはこのファイルを見て考えます。

1.  「コードには『サーバーAを作れ』とあるな」
2.  「記憶（`.tfstate`）を見ると…『前回サーバーAを作った』と書いてあるな」
3.  「じゃあ、**新しく作る必要はないな。何もしなくてOKだ**」

もしこのファイルがないと（記憶喪失になると）…
「コードには『サーバーAを作れ』とある。記憶にはない。**よし、新しいサーバーAを作ろう！**」
→ 結果、**サーバーが重複して作られたり、エラーになったりします。**

### ⚠️ 絶対に手で触るな！
このファイルはTerraformが管理するものです。人間が手で書き換えると、**現実と記憶の整合性が取れなくなり、インフラが壊れます。**
「触らぬ神に祟りなし」です。そっとしておきましょう。

---

## まとめ

*   **`main.tf`**: 設計図を書くところ。
*   **`terraform.tfvars`**: パスワードなどを書くところ（Git禁止）。
*   **`.tfstate`**: Terraformの記憶（セーブデータ）。**絶対にいじるな、消すな。**

これさえ覚えておけば、Terraformは怖くありません！
