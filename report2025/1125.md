# 2025-11-25 開発レポート

本日の開発内容、特に「RAGの仕組み」と「実装の意図」についての振り返りまとめです。

## 1. プロジェクトルールの策定
### 何をしたか
プロジェクトルートに `.cursorrules` ファイルを作成し、AIとの協業ルールを明文化しました。

### なぜしたか
単にコードを書くだけでなく、「なぜそのコードなのか」を理解し、ユーザー自身の「考える力」を育てるためです。また、勝手な実装を防ぎ、常に許可を得てから進めるフローを確立するためです。

### どうやったか
以下のルールを設定しました：
1.  **Plan & Intent First**: 実装前に必ず計画と意図を説明する。
2.  **Educational Focus**: 答えだけでなく、思考プロセスと理由を教える。
3.  **Permission Required**: 実装前に必ず許可を求める。
4.  **Line-by-Line Comments**: コードの1行1行に意味を記述する。

---

## 2. RAG (Retrieval-Augmented Generation) の仕組み
本日の学習の核心部分です。「教科書（知識）」と「テスト（質問）」の関係で理解しました。

### 2.1 知識を貯める (`/add`) = 「教科書を作る」
*   **プロセス**: テキスト入力 -> ベクトル化 (`getEmbedding`) -> Pineconeに保存 (`upsert`)
*   **ポイント**:
    *   AIは言葉を直接理解できないため、**「ベクトル（数値の羅列）」** に変換して保存します。
    *   これにより、後で「意味の近さ」を計算できるようになります。

### 2.2 質問する (`/ask`) = 「カンニングして答える」
*   **プロセス**: 質問入力 -> ベクトル化 -> Pineconeから類似検索 (`query`) -> 検索結果(Context)と質問を合わせてGeminiに送信 (`generate`)
*   **ポイント**:
    *   **質問自体はDBに保存されません。**
    *   AIは自分の知識ではなく、渡された「検索結果（カンニングペーパー）」を見て回答を作ります。

---

## 3. 実装内容の振り返り

### 3.1 教育的コメントの追加
*   **対象**: `src/index.ts`, `src/lib/pinecone.ts`, `src/lib/gemini.ts`
*   **意図**: コードが「何をしているか」だけでなく、「なぜそう書くのか」を理解できるようにするため。

### 3.2 フロントエンド (Next.js) の導入
*   **何をしたか**: 既存のバックエンド (Hono) に加えて、フロントエンド (Next.js) を導入しました。
*   **なぜしたか**: LINEだけでなく、Webブラウザからもチャットや知識登録を行えるようにするため。
*   **どうやったか**:
    *   `app/` ディレクトリを作成 (App Router)。
    *   バックエンドをポート `3001`、フロントエンドを `3000` に分離。
    *   `next.config.mjs` で `/api` へのリクエストをバックエンドに転送（プロキシ）。

### 3.3 Docker環境の整備
*   **何をしたか**: `docker compose up` コマンド一つで全環境が立ち上がるようにしました。
*   **なぜしたか**: フロントとバックを別々に起動する手間を省き、依存関係 (`node_modules`) も自動でインストールされるようにして開発を楽にするため。

### 3.4 知識登録機能の実装 (`/knowledge`)
*   **何をしたか**: ブラウザからテキストを入力してPineconeに保存する画面を作成しました。
*   **なぜしたか**: 「知識を貯める」体験をするため。また、保存前に人間がデータを整理（前処理）することの重要性を理解するため。

### 3.5 デザイン刷新 (Neo-Brutalism)
*   **何をしたか**: 10代〜20代（Z世代）向けの「Neo-Brutalism」デザインを適用しました。
*   **特徴**: 太い黒枠、鮮やかな原色、ずらした影、大きなタイポグラフィ。
*   **どうやったか**: `app/globals.css` にデザイン変数を定義し、全体に適用しました。
